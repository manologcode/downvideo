<div align="center">

# Downvideo API (YouTube → texto, audio y video)

[![FastAPI](https://img.shields.io/badge/FastAPI-0.11+-009688?logo=fastapi&logoColor=white)](https://fastapi.tiangolo.com/)
[![Docker](https://img.shields.io/badge/Docker-ready-2496ED?logo=docker&logoColor=white)](https://www.docker.com/)
[![yt-dlp](https://img.shields.io/badge/yt--dlp-latest-FFEE58)](https://github.com/yt-dlp/yt-dlp)

</div>

API sencilla para descargar contenido de YouTube de tres formas:

- Texto: descarga subtítulos (normales o automáticos) y los convierte en texto plano.
- Audio: descarga el audio del vídeo en MP3.
- Video: descarga el vídeo en MP4.

Construida con FastAPI + yt-dlp y lista para ejecutarse en Docker. Algunas descargas pueden requerir cookies de sesión (cookies.txt).

---

## Características

- Endpoints asíncronos con polling de estado por `task_id`.
- Subtítulos normales o automáticos (autogenerated), con extracción a `.txt`.
- Descarga de audio (MP3) y vídeo (MP4).
---


## Configurar cookies (opcional pero recomendado)

Algunos vídeos requieren estar autenticado. Para ello puedes pasar un `cookies.txt` exportado desde tu navegador.

1) Instala una extensión para exportar cookies:
   - Firefox: https://addons.mozilla.org/en-US/firefox/addon/cookies-txt/
   - Chrome: busca “Get cookies.txt” en Chrome Web Store.
2) Inicia sesión en YouTube en tu navegador.
3) Usa la extensión para exportar solo las cookies del dominio actual a un archivo llamado `cookies.txt`.
4) Colócalo en:
   - Ejecución local: en la raíz del repo (`./cookies.txt`).
   - Docker: móntalo en `/app/cookies.txt` dentro del contenedor.

Nota: La aplicación solo usará cookies si el archivo existe y tiene contenido. No subas tus cookies a repos públicos.

---

### Docker Compose

Este repo incluye `docker-compose.yml` y `docker-compose.override.yml`. Para desarrollo local (con recarga y volúmenes montados):

```bash
docker compose up --build
```

---

## API Reference

Todas las rutas son asíncronas: devuelven un `task_id` y debes consultar su estado en `/task/{task_id}`.

Parámetros comunes:
- `url` (query): URL completa del vídeo de YouTube.
- `lang` (query, opcional en `/subtitles`): idioma de subtítulos preferido (ej. `es`, `en`).

### 1) Obtener subtítulos como texto
- GET `/subtitles?url=...&lang=es`
- Resultado (al completar la tarea):
  ```json
  {
    "title": "...",
    "file_name": "nombre_normalizado",
    "lang": "es",
    "text": "Texto extraído de los subtítulos..."
  }
  ```

### 2) Obtener título del vídeo
- GET `/title?url=...`
- Resultado: título como string.

### 3) Descargar audio (MP3)
- GET `/audio?url=...`
- Resultado:
  ```json
  {
    "title": "...",
    "file_name": "archivo.mp3"
  }
  ```
- El archivo se guarda en `resources/audios/`.
- Para descarga directa por HTTP puedes usar: `GET /get-audio-file/{filename}`.

### 4) Descargar vídeo (MP4)
- GET `/video?url=...`
- Resultado:
  ```json
  {
    "title": "...",
    "file_name": "archivo.mp4"
  }
  ```
- El archivo se guarda en `resources/videos/`.

### 5) Descarga automática de audio y envío a servicio externo
- POST `/auto-audio` (application/json)
  - Body: `{ "url": "https://www.youtube.com/..." }`
  - Respuesta inmediata: `{ "task_id": "...", "status": "processing" }`
  - Proceso en background:
    1. Descarga el audio del vídeo en MP3
    2. Lo sube automáticamente a `EXTERNAL_API_URL/external_link`
    3. Puedes consultar el estado con `GET /task/{task_id}`
  - Resultado (al completar):
    ```json
    {
      "status": "completed",
      "result": {
        "message": "Audio downloaded and uploaded successfully",
        "filename": "archivo.mp3",
        "title": "Título del vídeo"
      }
    }
    ```
  - Requiere la variable `EXTERNAL_API_URL` configurada.

### 6) Estado de tareas
- GET `/task/{task_id}` → `{ status: processing|completed|error, result, error }`
- GET `/tasks` → listado de tareas en memoria.

### 7) Envío a servicio externo
- POST `/send-external` (multipart/form-data)
  - Campos: `title`, `url`, `filename`, `file` (UploadFile)
  - Usa la variable `EXTERNAL_API_URL` (base URL). La app envía a `EXTERNAL_API_URL/external_link`.

---
## Ejecución con interface web

Se a incorporado una interface web para descarga de audio y enviarlo a otra aplicacion web para almacenarlo o consumirlo

<div align="center">
  <img src="./screenshot.png" alt="Screenshot de al aplicación" width="600"/>
</div>

Imagen publicada (recomendada para empezar rápido):

```bash
# Linux / macOS
docker run -d -p 5000:5000 manologcode/downvideo
```

Para ejecutar con todos los parametros

```bash
# Linux / macOS
docker run -d \
  --name downvideo \
  -p 5000:5000 \
  -v "$(pwd)/cookies.txt:/app/cookies.txt" \
  -e EXTERNAL_API_URL="http://localhost:5002/external_link" \
  manologcode/downvideo
```

- La API quedará disponible en http://localhost:5000
- Si vas a usar el endpoint `/send-external`, ajusta `EXTERNAL_API_URL` al host/puerto de tu servicio externo. hace un envio de archivo por POST con los parametros  { title: "titulo", url: "https://www.youtube.com/...", filename: "ejemplo.mp3", file }

para ejecutar una creacio automatica

```
curl -X POST http://localhost:5000/auto-audio \
-H "Content-Type: application/json" \
-d '{"url": "https://www.youtube.com/watch?v=ae4HtFudbGU"}'

```